steps:
- bash: |
    for i in "-vfxt" "-filer" "-storage" "-proxy" "-network"; do  
      rg_del_rc=111111
      exists=$(az group exists --name ${RESOURCE_GROUP_NAME}$i)
      if [ "${exists}" = "true" ]; then
        echo "${RESOURCE_GROUP_NAME}$i exists"
        for i in {1..3}; do
          az group delete --yes --name ${RESOURCE_GROUP_NAME}$i --subscription ${ARM_SUBSCRIPTION_ID}
          rg_del_rc=$?
          if [ "${rg_del_rc}" -ne 0 ]; then
            echo "##vso[task.logissue type=error;]Deleting resource group ${RESOURCE_GROUP_NAME}$i failed. Attempt $i of 3."
            echo "##vso[task.complete result=Failed;]"
          else
            break
          fi
        done
      fi
    done
  displayName: 'CLEANUP: Delete resource group'
  condition: always()
