steps:
- script: |
    cd src/terraform/examples/vfxt/${RUN_TERRAFORM_FILE}
    
    tf_destroy_rc=111111
    for i in {1..5}; do
      TF_LOG=INFO terraform destroy -auto-approve
      tf_destroy_rc=$?
      if [ "${tf_destroy_rc}" -ne 0 ]; then
        sleep 20
        echo "##vso[task.logissue type=warning;]Terraform destroy did not work. Attempt $i of 5."
      else
        break
      fi
    done
  displayName: 'Terraform: Destroy'
  condition: always()